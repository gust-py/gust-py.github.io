<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Assistente Web — Demo</title>
<style>
  :root{--bg:#0b0f13;--card:#07111a;--accent:#66ccff;--muted:#9fb3c8}
  html,body{height:100%;margin:0;background:var(--bg);color:#dbeaf6;font-family:Inter,system-ui,Arial}
  .app{max-width:900px;margin:18px auto;border-radius:12px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,0.6)}
  .panel{display:flex;height:85vh;background:linear-gradient(180deg,#07121a 0%, #041018 100%)}
  .left{width:360px;border-right:1px solid rgba(255,255,255,0.03);padding:14px;box-sizing:border-box;background:var(--card)}
  .brand{font-weight:700;color:var(--accent);font-size:18px;margin-bottom:8px}
  .muted{color:var(--muted);font-size:13px}
  .right{flex:1;display:flex;flex-direction:column}
  .messages{flex:1;padding:18px;overflow:auto;gap:12px;display:flex;flex-direction:column-reverse}
  .composer{display:flex;padding:12px;border-top:1px solid rgba(255,255,255,0.03);align-items:center;gap:8px}
  textarea{flex:1;min-height:44px;max-height:140px;padding:10px;border-radius:8px;border:0;background:#071722;color:#e8f6ff;resize:none;outline:none}
  button{background:var(--accent);border:0;padding:10px 12px;border-radius:8px;color:#001;font-weight:700;cursor:pointer}
  .msg{max-width:78%;padding:10px 12px;border-radius:10px;line-height:1.35}
  .user{align-self:flex-end;background:linear-gradient(90deg,#2b6bff,#66ccff);color:#001;border-bottom-right-radius:2px}
  .bot{align-self:flex-start;background:#071c27;border:1px solid rgba(255,255,255,0.03)}
  .meta{font-size:12px;color:var(--muted);margin-top:8px}
  .small{font-size:12px;color:var(--muted)}
  .row{display:flex;gap:8px;align-items:center}
  .settings{margin-top:12px;border-top:1px dashed rgba(255,255,255,0.03);padding-top:10px}
  .keybox{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#06141a;color:#dff3ff}
  .link{color:var(--accent);text-decoration:none}
  footer{font-size:12px;color:var(--muted);text-align:center;padding:8px}
  @media(max-width:800px){.panel{flex-direction:column}.left{width:auto;border-right:0}}
</style>
</head>
<body>
  <div class="app" role="application" aria-label="Assistente Web">
    <div class="panel">
      <div class="left">
        <div class="brand">Assistente Web</div>
        <div class="muted">Chatbot assistente — versão leve</div>

        <div class="settings">
          <div style="margin-bottom:8px;font-size:13px;color:var(--muted)">Configuração</div>
          <label class="small">Modelo Hugging Face (opcional)</label>
          <input id="modelInput" class="keybox" placeholder="ex: gpt2 or eleutherai/gpt-neo-2.7B (opcional)"/>
          <div style="height:8px"></div>
          <label class="small">Hugging Face API Key (opcional para usar IA real)</label>
          <input id="apiKey" class="keybox" placeholder="Coloque a API key temporariamente para testar (não commit)" />
          <div style="height:8px"></div>
          <div class="row" style="justify-content:space-between">
            <button id="saveBtn">Salvar (Local)</button>
            <button id="clearBtn" class="link" style="background:transparent;border:0;color:var(--muted)">Limpar chave</button>
          </div>
          <div class="meta">Sem chave: modo <strong>demo</strong> local (respostas simples). Com chave: conversa real via Hugging Face Inference API.</div>
        </div>

        <div style="height:18px"></div>
        <div class="small">Deploy: GitHub Pages — envie este arquivo `index.html`</div>
        <div class="small" style="margin-top:6px">Aviso: não publique chaves em repositório público. Use serverless/proxy para produção.</div>
      </div>

      <div class="right">
        <div style="display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px solid rgba(255,255,255,0.03)">
          <div><strong>Conversa</strong><div class="small muted">Assistente — personalidade: profissional e prestativo</div></div>
          <div class="small muted" id="status">Modo: <span id="mode">demo</span></div>
        </div>

        <div id="messageContainer" class="messages" aria-live="polite"></div>

        <div class="composer">
          <textarea id="input" placeholder="Escreva algo e pressione Enter..." aria-label="Mensagem"></textarea>
          <button id="sendBtn">Enviar</button>
        </div>
      </div>
    </div>
    <footer>Assistente Web • Demo • Não exponha chaves publicamente</footer>
  </div>

<script>
/*
  Chat UI + Hugging Face Inference API client (browser)
  Usage:
   - Without API key: demo fallback responses
   - With API key & model: calls HF inference endpoint
  Security note: embedding API key in client is insecure for production.
*/

const input = document.getElementById('input');
const sendBtn = document.getElementById('sendBtn');
const container = document.getElementById('messageContainer');
const apiKeyInput = document.getElementById('apiKey');
const modelInput = document.getElementById('modelInput');
const saveBtn = document.getElementById('saveBtn');
const clearBtn = document.getElementById('clearBtn');
const modeSpan = document.getElementById('mode');
const status = document.getElementById('status');

let HF_API_KEY = localStorage.getItem('hf_api_key') || '';
let HF_MODEL = localStorage.getItem('hf_model') || '';
if(HF_API_KEY) apiKeyInput.value = HF_API_KEY;
if(HF_MODEL) modelInput.value = HF_MODEL;
updateMode();

function updateMode(){
  const mode = HF_API_KEY ? 'HuggingFace API' : 'demo';
  modeSpan.textContent = mode;
  status.textContent = `Modo: ${mode}`;
}

// simple helper to append messages
function appendMessage(text, who='bot'){
  const el = document.createElement('div');
  el.className = 'msg ' + (who==='user' ? 'user' : 'bot');
  el.textContent = text;
  container.prepend(el);
  return el;
}

// demo fallback (rule-based / canned)
function demoResponse(prompt){
  // respostas simples com variação
  const lower = prompt.toLowerCase();
  if(lower.includes('olá') || lower.includes('oi')) return 'Olá! Eu sou seu assistente — diga o que precisa.';
  if(lower.includes('ajuda')) return 'Posso te ajudar com código, orientação técnica, ideias e deploy.';
  if(lower.includes('github')) return 'Para publicar no GitHub Pages, crie um repo `seunome.github.io` e suba `index.html`.';
  if(lower.includes('como') && lower.includes('fazer')) return 'Explique em poucas palavras o que quer fazer e eu guio passo a passo.';
  // fallback
  const phrases = [
    'Interessante — conta mais um pouco.',
    'Hum, entendi. Quer que eu explique passo a passo?',
    'Boa pergunta. Posso responder com detalhe ou dar um resumo — qual prefere?'
  ];
  return phrases[Math.floor(Math.random()*phrases.length)];
}

// Hugging Face Inference call
async function callHuggingFace(prompt){
  const model = HF_MODEL || 'gpt2';
  const url = `https://api-inference.huggingface.co/models/${model}`;
  const headers = { 'Accept': 'application/json', 'Content-Type': 'application/json' };
  if(!HF_API_KEY) throw new Error('Sem API Key');
  headers['Authorization'] = 'Bearer ' + HF_API_KEY;
  // basic payload — adjust params per model if needed
  const body = JSON.stringify({ inputs: prompt, parameters: { max_new_tokens: 256, temperature: 0.7 } });
  const resp = await fetch(url, { method: 'POST', headers, body });
  if(!resp.ok){
    const txt = await resp.text();
    throw new Error(`Erro HF: ${resp.status} ${txt}`);
  }
  // response may be JSON { generated_text: "..."} or array [{generated_text: "..."}] or plain text
  const ct = resp.headers.get('content-type') || '';
  if(ct.includes('application/json')){
    const data = await resp.json();
    if(Array.isArray(data) && data[0] && data[0].generated_text) return data[0].generated_text;
    if(data.generated_text) return data.generated_text;
    // some models return an object with choices
    if(data.hasOwnProperty('error')) throw new Error('Erro do modelo: '+data.error);
    // if array of tokens etc
    try{ return JSON.stringify(data); }catch(e){ return String(data); }
  } else {
    return await resp.text();
  }
}

// main send handler
async function sendMessage(){
  const text = input.value.trim();
  if(!text) return;
  appendMessage(text, 'user');
  input.value = '';
  const loader = appendMessage('…', 'bot');

  if(HF_API_KEY){
    try{
      const prompt = `Você é um assistente prestativo e conciso. Responda em português.\n\nUsuário: ${text}\nAssistente:`;
      const reply = await callHuggingFace(prompt);
      loader.textContent = (reply || 'Sem resposta do modelo').trim();
    }catch(err){
      console.error(err);
      loader.textContent = 'Erro ao acessar API: ' + err.message;
      // fallback to demo
      const fb = demoResponse(text);
      const fallbackEl = appendMessage(fb, 'bot');
      fallbackEl.style.opacity = 0.9;
    }
  } else {
    // demo mode
    const r = demoResponse(text);
    loader.textContent = r;
  }
  container.scrollTop = 0;
}

// UI wiring
sendBtn.addEventListener('click', sendMessage);
input.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); } });

// save key locally (only for testing)
saveBtn.addEventListener('click', ()=>{
  HF_API_KEY = apiKeyInput.value.trim();
  HF_MODEL = modelInput.value.trim();
  if(HF_API_KEY) localStorage.setItem('hf_api_key', HF_API_KEY); else localStorage.removeItem('hf_api_key');
  if(HF_MODEL) localStorage.setItem('hf_model', HF_MODEL); else localStorage.removeItem('hf_model');
  updateMode();
  alert('Chave salva localmente no navegador (para teste). NÃO faça commit em repositório público.');
});
clearBtn.addEventListener('click', ()=>{
  HF_API_KEY=''; HF_MODEL='';
  apiKeyInput.value=''; modelInput.value='';
  localStorage.removeItem('hf_api_key'); localStorage.removeItem('hf_model');
  updateMode();
  alert('Chave removida do storage local.');
});

// welcome
appendMessage('Olá — eu sou seu assistente. Posso te ajudar com código, deploy e ideias. Teste sem chave em modo demo ou cole sua Hugging Face API key para usar um modelo real.', 'bot');

</script>
</body>
  </html>
