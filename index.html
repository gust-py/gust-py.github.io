<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Jarvis Web</title>
<style>
  body,html{margin:0;padding:0;height:100%;background:#000;color:#fff;font-family:sans-serif;overflow:hidden}
  canvas{position:absolute;top:0;left:0;z-index:-1}
  #chat{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:90%;max-width:600px;background:rgba(0,0,0,0.5);border-radius:12px;padding:12px;box-sizing:border-box}
  #messages{height:250px;overflow-y:auto;margin-bottom:8px}
  .msg{margin:4px 0;padding:6px 10px;border-radius:8px;max-width:80%;line-height:1.3}
  .user{background:linear-gradient(90deg,#2b6bff,#66ccff);color:#001;margin-left:auto}
  .bot{background:#111;border:1px solid rgba(255,255,255,0.1)}
  #input{width:100%;padding:8px;border-radius:8px;border:none;background:#222;color:#fff;outline:none;box-sizing:border-box}
  #send{margin-top:4px;width:100%;padding:8px;border:none;border-radius:8px;background:#66ccff;color:#001;font-weight:bold;cursor:pointer}
</style>
</head>
<body>
<canvas id="bg"></canvas>

<div id="chat">
  <div id="messages"></div>
  <input type="text" id="input" placeholder="Escreva algo...">
  <button id="send">Enviar</button>
</div>

<script>
const canvas = document.getElementById('bg');
const ctx = canvas.getContext('2d');
let W = canvas.width = window.innerWidth;
let H = canvas.height = window.innerHeight;

window.addEventListener('resize', ()=>{ W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight; });

// Estrelas animadas
const stars=[];
for(let i=0;i<200;i++){ stars.push({x:Math.random()*W,y:Math.random()*H,r:Math.random()*1.5+0.5,s:Math.random()*0.5}) }

function drawStars(){
  ctx.fillStyle='black';
  ctx.fillRect(0,0,W,H);
  for(let s of stars){
    s.y+=s.s;
    if(s.y>H) s.y=0;
    ctx.fillStyle='white';
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  }
  requestAnimationFrame(drawStars);
}
drawStars();

// Chat
const input=document.getElementById('input');
const send=document.getElementById('send');
const messages=document.getElementById('messages');

function addMessage(text,type){
  const div=document.createElement('div');
  div.className='msg '+type;
  div.textContent=text;
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;
}

async function askJarvis(question){
  addMessage(question,'user');
  addMessage('â€¦','bot');
  try{
    const res=await fetch('http://localhost:3000/ask',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({question})
    });
    const data=await res.json();
    messages.lastChild.textContent=data.answer;
  }catch(e){
    messages.lastChild.textContent='Erro ao acessar o servidor.';
    console.error(e);
  }
}

send.addEventListener('click', ()=>{ if(input.value.trim()) { askJarvis(input.value.trim()); input.value=''; } });
input.addEventListener('keydown',e=>{ if(e.key==='Enter' && input.value.trim()){ askJarvis(input.value.trim()); input.value=''; } });
</script>
</body>
</html>
