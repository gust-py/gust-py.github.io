<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pokemon Game Prototype</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#fff;
  display:flex;
}

/* SIDEBAR */
.sidebar{
  width:200px;
  background:#fff;
  border-right:2px solid #000;
  padding:15px;
  box-sizing:border-box;
}
.sidebar button{
  width:100%;
  margin-bottom:10px;
  padding:10px;
  background:#fff;
  border:2px solid #000;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
}

/* CONTENT */
.content{
  flex:1;
  padding:20px;
}

header{
  font-size:24px;
  font-weight:bold;
  margin-bottom:15px;
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:20px;
}

/* CARD */
.card{
  border-radius:10px;
  padding:10px;
  color:#fff;
  position:relative;
}
.card img{
  width:90px;
  height:90px;
  position:absolute;
  right:10px;
  top:-15px;
}
.card .name{font-size:16px;}
.card .number{color:#000;font-weight:bold;}
.card button{
  margin-top:10px;
  padding:6px;
  width:100%;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

/* HP BAR */
.hp{
  height:10px;
  border-radius:5px;
  margin-top:8px;
}
.green{background:#4CAF50;}
.yellow{background:#FBC02D;}
.red{background:#E53935;}
</style>
</head>

<body>

<div class="sidebar">
  <button onclick="openPokedex()">PokéDex</button>
  <button onclick="openPokemons()">Pokémons</button>
  <button onclick="openForest()">Floresta</button>
</div>

<div class="content">
  <header id="title">PokéDex</header>
  <div id="screen"></div>
</div>

<script>
const screen = document.getElementById("screen");
const title = document.getElementById("title");

const TOTAL_POKEMON = 386;
const pokedex = [];
const myPokemons = [];

let forestTimer = null;
let wildPokemon = null;

/* ---------- UTIL ---------- */
const cap = s => s[0].toUpperCase()+s.slice(1);

async function fetchPokemon(id){
  const r = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
  return r.json();
}

/* ---------- INIT ---------- */
async function loadPokedex(){
  for(let i=1;i<=TOTAL_POKEMON;i++){
    const p = await fetchPokemon(i);
    pokedex.push(p);
  }
  openPokedex();
}

/* ---------- IV SYSTEM ---------- */
function generateIVs(){
  const roll = Math.random()*100;
  let min = 0, max = 15;

  if(roll <= 1) min=24;
  else if(roll <= 8) min=21;
  else if(roll <= 15) min=20;
  else if(roll <= 25) min=18;
  else if(roll <= 40) min=15;
  else if(roll <= 60) min=10;
  else if(roll <= 80) min=6;
  else min=0;

  return Array(6).fill(0).map(()=>Math.floor(Math.random()*(max-min+1))+min);
}

/* ---------- LEVEL RULES ---------- */
function generateLevel(p){
  const evoLevels = p.species?.evolution_chain || null;
  if(p.id < 152) return Math.floor(Math.random()*15)+1;
  return Math.floor(Math.random()*30)+5;
}

/* ---------- HP STATE ---------- */
function hpState(hp){
  if(hp > 66) return "green";
  if(hp > 33) return "yellow";
  return "red";
}

/* ---------- CAPTURE CHANCE ---------- */
function captureChance(hp){
  if(hp > 66) return 0.3;
  if(hp > 33) return 0.5;
  return 0.7;
}

/* ---------- PAGES ---------- */
function openPokedex(){
  title.textContent="PokéDex";
  screen.innerHTML="";
  const grid=document.createElement("div");
  grid.className="grid";

  pokedex.forEach(p=>{
    const c=document.createElement("div");
    c.className="card";
    c.style.background="#aaa";
    c.innerHTML=`
      <div class="number">#${p.id.toString().padStart(3,"0")}</div>
      <div class="name">${cap(p.name)}</div>
      <img src="${p.sprites.front_default}">
    `;
    grid.appendChild(c);
  });
  screen.appendChild(grid);
}

function openPokemons(){
  title.textContent="Pokémons";
  screen.innerHTML="";
  const grid=document.createElement("div");
  grid.className="grid";

  myPokemons.forEach(p=>{
    const c=document.createElement("div");
    c.className="card";
    c.style.background="#4CAF50";
    c.innerHTML=`
      <div class="name">${cap(p.name)}</div>
      <div>Level: ${p.level}</div>
      <div>IV Total: ${p.ivPercent}%</div>
    `;
    grid.appendChild(c);
  });

  screen.appendChild(grid);
}

/* ---------- FOREST ---------- */
function openForest(){
  title.textContent="Floresta";
  screen.innerHTML="<p>Aguardando Pokémon selvagem...</p>";
  startForestTimer();
}

function startForestTimer(){
  if(forestTimer) clearTimeout(forestTimer);
  forestTimer = setTimeout(spawnPokemon, 10000); // 10s TESTE
}

function spawnPokemon(){
  const base = pokedex[Math.floor(Math.random()*pokedex.length)];
  const ivs = generateIVs();
  const level = generateLevel(base);
  const totalIV = ivs.reduce((a,b)=>a+b,0);
  const ivPercent = Math.round((totalIV/(30*6))*100);

  wildPokemon={
    name:base.name,
    sprite:base.sprites.front_default,
    ivs,
    ivPercent,
    level,
    hp:100
  };

  renderWildPokemon();
}

function renderWildPokemon(){
  screen.innerHTML="";
  const c=document.createElement("div");
  c.className="card";
  c.style.background="#8BC34A";
  const hpClass = hpState(wildPokemon.hp);

  c.innerHTML=`
    <div class="name">${cap(wildPokemon.name)}</div>
    <img src="${wildPokemon.sprite}">
    <div class="hp ${hpClass}" style="width:${wildPokemon.hp}%;"></div>
    <button onclick="attack()">Atacar</button>
    <button onclick="capture()">Capturar</button>
  `;
  screen.appendChild(c);
}

function attack(){
  wildPokemon.hp -= Math.floor(Math.random()*25)+10;
  if(wildPokemon.hp <=0){
    wildPokemon=null;
    screen.innerHTML="<p>Pokémon derrotado.</p>";
    startForestTimer();
  }else renderWildPokemon();
}

function capture(){
  const chance = captureChance(wildPokemon.hp);
  if(Math.random() <= chance){
    myPokemons.push(wildPokemon);
    wildPokemon=null;
    screen.innerHTML="<p>Pokémon capturado!</p>";
    startForestTimer();
  }else{
    renderWildPokemon();
  }
}

loadPokedex();
</script>

</body>
  </html>
